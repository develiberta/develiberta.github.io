<!DOCTYPE html><html lang="en" mode="light" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="day-prompt" content="days ago"><meta name="hour-prompt" content="hours ago"><meta name="minute-prompt" content="minutes ago"><meta name="justnow-prompt" content="just now"><meta name="generator" content="Jekyll v4.4.1" /><meta property="og:title" content="OS Synchronization Examples" /><meta name="author" content="Develiberta" /><meta property="og:locale" content="en" /><meta name="description" content="목적 동기화 예제들을 이해한다." /><meta property="og:description" content="목적 동기화 예제들을 이해한다." /><link rel="canonical" href="https://develiberta.github.io/posts/os-synchronization-examples/" /><meta property="og:url" content="https://develiberta.github.io/posts/os-synchronization-examples/" /><meta property="og:site_name" content="Develiberta" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-12-25T18:00:00+09:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="OS Synchronization Examples" /><meta name="twitter:site" content="@develiberta" /><meta name="twitter:creator" content="@Develiberta" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Develiberta"},"dateModified":"2023-01-08T21:17:55+09:00","datePublished":"2022-12-25T18:00:00+09:00","description":"목적 동기화 예제들을 이해한다.","headline":"OS Synchronization Examples","mainEntityOfPage":{"@type":"WebPage","@id":"https://develiberta.github.io/posts/os-synchronization-examples/"},"url":"https://develiberta.github.io/posts/os-synchronization-examples/"}</script><title>OS Synchronization Examples | Develiberta</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png?v=1743601323"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png?v=1743601323"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png?v=1743601323"><link rel="manifest" href="/assets/img/favicons/site.webmanifest?v=1743601323"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico?v=1743601323"><meta name="apple-mobile-web-app-title" content="Develiberta"><meta name="application-name" content="Develiberta"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css?v=1743601323"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css?v=1743601323"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end" lang="en"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/?v=1743601323" alt="avatar" class="mx-auto"> <img src="/assets/img/favicons/android-chrome-512x512.png" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/?v=1743601323">Develiberta</a></div><div class="site-subtitle font-italic"></div></div><ul class="w-100"><li class="nav-item"> <a href="/?v=1743601323" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/?v=1743601323" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/?v=1743601323" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/?v=1743601323" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/?v=1743601323" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://github.com/develiberta?v=1743601323" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/develiberta?v=1743601323" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['develiberta','gmail.com'].join('@')?v=1743601323" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml?v=1743601323" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/?v=1743601323"> Home </a> </span> <span>OS Synchronization Examples</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>OS Synchronization Examples</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="semi-bold"> Develiberta </span> on <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Sun, Dec 25, 2022, 6:00 PM +0900" >Dec 25, 2022<i class="unloaded">2022-12-25T18:00:00+09:00</i> </span></div><div> <span> Updated <span class="timeago lastmod" data-toggle="tooltip" data-placement="bottom" title="Sun, Jan 8, 2023, 9:17 PM +0900" >Jan 8, 2023<i class="unloaded">2023-01-08T21:17:55+09:00</i> </span> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="3262 words">18 min read</span></div></div><div class="post-content"><h2 id="목적">목적</h2><hr /><ol><li>동기화 예제들을 이해한다.</ol><h2 id="실천-목표">실천 목표</h2><hr /><ol><li>유한 버퍼, readers-writer 및 식사하는 철학자 동기화 문제에 관해 설명한다.</ol><h2 id="동시성-제어-문제의-분류">동시성 제어 문제의 분류</h2><hr /><ol><li>유한 버퍼 문제 The Bounded Buffer Problem<li>Readers-Writers 문제 The Readers-Writers Problem<li>식사하는 철학자들 문제 The Dining Philosophers Problem</ol><h2 id="유한-버퍼-문제-the-bounded-buffer-problem">유한 버퍼 문제 (The Bounded Buffer Problem)</h2><hr /><ol><li>생산자-소비자 문제 중 다음의 특정 조건을 만족<ul><li>n개의 버퍼로 구성된 풀(pool)이 있으며 각 버퍼는 한 항목(item)을 저장할 수 있다고 가정</ul><li>다음과 같은 자료구조를 가짐<div lang="c" class="language-c highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre>     <span class="kt">int</span> <span class="n">n</span><span class="p">;</span>
     <span class="n">semaphore</span> <span class="n">mutex</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
     <span class="n">semaphore</span> <span class="n">empty</span> <span class="o">=</span> <span class="n">n</span><span class="p">;</span>
     <span class="n">semaphore</span> <span class="n">full</span>	<span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</pre></table></code></div></div><ul><li>mutex 이진 세마포는 버퍼 풀에 접근하기 위한 상호 배제 기능을 제공 (1로 초기화)<li>empty는 비퍼 있는 버퍼의 수를, full은 꽉 찬 버퍼의 수를 기록 (empty는 n 값으로 초기화, full은 0으로 초기화)</ul><li>생산자 프로세스<div lang="c" class="language-c highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre>     <span class="k">while</span> <span class="p">(</span><span class="nb">true</span><span class="p">)</span> <span class="p">{</span>
         <span class="cm">/* ... */</span>
         <span class="cm">/* produce an item in next_produced */</span>
         <span class="cm">/* ... */</span>
         <span class="n">wait</span><span class="p">(</span><span class="n">empty</span><span class="p">);</span>	<span class="c1">// consumer가 buffer를 다 비울 때까지 기다림</span>
         <span class="n">wait</span><span class="p">(</span><span class="n">mutex</span><span class="p">);</span>	<span class="c1">// 여기까지 수행했다면 buffer가 비어있고 이 프로세스 혼자만 들어온 게 보장됨</span>
         <span class="cm">/* ... */</span>
         <span class="cm">/* add next_produced to the buffer */</span>
         <span class="cm">/* ... */</span>
         <span class="n">signal</span><span class="p">(</span><span class="n">mutex</span><span class="p">);</span>	<span class="c1">// 끝난 후에 반납</span>
         <span class="n">signal</span><span class="p">(</span><span class="n">full</span><span class="p">);</span>	<span class="c1">// buffer가 다 찼음을 consumer에 알림</span>
     <span class="p">}</span>
</pre></table></code></div></div><li>소비자 프로세스<div lang="c" class="language-c highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre>     <span class="k">while</span> <span class="p">(</span><span class="nb">true</span><span class="p">)</span> <span class="p">{</span>
         <span class="n">wait</span><span class="p">(</span><span class="n">full</span><span class="p">);</span>		<span class="c1">// signal(full)을 받아야만 깨어남</span>
         <span class="n">wait</span><span class="p">(</span><span class="n">mutex</span><span class="p">);</span>	<span class="c1">// 여기까지 수행했다면 buffer가 가득 차 있고 이 프로세스 혼자만 들어온 게 보장됨</span>
         <span class="cm">/* ... */</span>
         <span class="cm">/* remove an item from buffer to next_consumed */</span>
         <span class="cm">/* ... */</span>
         <span class="n">signal</span><span class="p">(</span><span class="n">mutex</span><span class="p">);</span>	<span class="c1">// 끝난 후에 반납</span>
         <span class="n">signal</span><span class="p">(</span><span class="n">empty</span><span class="p">);</span>	<span class="c1">// buffer가 비어있음을 producer에 알림</span>
     <span class="p">}</span>
</pre></table></code></div></div><li>예제 소스<ol><li>PThread Solution<div lang="c" class="language-c highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
</pre><td class="rouge-code"><pre>     <span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span>     <span class="cp">#include</span> <span class="cpf">&lt;stdlib.h&gt;</span><span class="cp">
</span>     <span class="cp">#include</span> <span class="cpf">&lt;unistd.h&gt;</span><span class="cp">
</span>     <span class="cp">#include</span> <span class="cpf">&lt;pthread.h&gt;</span><span class="cp">
</span>     <span class="cp">#include</span> <span class="cpf">&lt;semaphore.h&gt;</span><span class="cp">
</span>
     <span class="cp">#define true 1
</span>     <span class="cp">#define BUFFER_SIZE 5
</span>
     <span class="kt">int</span> <span class="n">buffer</span><span class="p">[</span><span class="n">BUFFER_SIZE</span><span class="p">];</span>

     <span class="n">pthread_mutex_t</span> <span class="n">mutex</span><span class="p">;</span>
     <span class="n">sem_t</span> <span class="n">empty</span><span class="p">,</span> <span class="n">full</span><span class="p">;</span>

     <span class="kt">int</span> <span class="n">in</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">out</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

     <span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">argv</span><span class="p">[])</span> <span class="p">{</span>
         <span class="kt">int</span> <span class="n">i</span><span class="p">,</span> <span class="n">numOfProducers</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">numOfConsumers</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
         <span class="n">pthread_t</span> <span class="n">tid</span><span class="p">;</span>

         <span class="n">pthread_mutex_init</span><span class="p">(</span><span class="o">&amp;</span><span class="n">mutex</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
         <span class="n">sem_init</span><span class="p">(</span><span class="o">&amp;</span><span class="n">empty</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">BUFFER_SIZE</span><span class="p">);</span>
         <span class="n">sem_init</span><span class="p">(</span><span class="o">&amp;</span><span class="n">full</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
         <span class="n">srand</span><span class="p">(</span><span class="n">time</span><span class="p">(</span><span class="mi">0</span><span class="p">));</span>

         <span class="c1">// Create the Producers</span>
         <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">numOfProducers</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
             <span class="n">pthread_create</span><span class="p">(</span><span class="o">&amp;</span><span class="n">tid</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="n">producer</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
				
         <span class="c1">// Create the Consumers</span>
         <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">numOfConsumers</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
             <span class="n">pthread_create</span><span class="p">(</span><span class="o">&amp;</span><span class="n">tid</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="n">consumer</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>

         <span class="n">sleep</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
         <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
     <span class="p">}</span>

     <span class="kt">void</span> <span class="o">*</span><span class="nf">producer</span><span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="n">param</span><span class="p">)</span> <span class="p">{</span>
         <span class="kt">int</span> <span class="n">item</span><span class="p">;</span>
         <span class="k">while</span> <span class="p">(</span><span class="nb">true</span><span class="p">)</span> <span class="p">{</span>
             <span class="n">usleep</span><span class="p">((</span><span class="mi">1</span> <span class="o">+</span> <span class="n">rand</span><span class="p">()</span> <span class="o">%</span> <span class="mi">5</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100000</span><span class="p">);</span>
             <span class="n">item</span> <span class="o">=</span> <span class="mi">1000</span> <span class="o">+</span> <span class="n">rand</span><span class="p">()</span> <span class="o">%</span> <span class="mi">1000</span><span class="p">;</span>
             <span class="n">insert_item</span><span class="p">(</span><span class="n">item</span><span class="p">);</span>	<span class="c1">// critical section in fuction</span>
         <span class="p">}</span>
     <span class="p">}</span>

     <span class="kt">void</span> <span class="o">*</span><span class="nf">consumer</span><span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="n">param</span><span class="p">)</span> <span class="p">{</span>
         <span class="kt">int</span> <span class="n">item</span><span class="p">;</span>
         <span class="k">while</span> <span class="p">(</span><span class="nb">true</span><span class="p">)</span> <span class="p">{</span>
             <span class="n">usleep</span><span class="p">((</span><span class="mi">1</span> <span class="o">+</span> <span class="n">rand</span><span class="p">()</span> <span class="o">%</span> <span class="mi">5</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100000</span><span class="p">);</span>
             <span class="n">remove_item</span><span class="p">(</span><span class="o">&amp;</span><span class="n">item</span><span class="p">);</span>	<span class="c1">// critical section in function</span>
         <span class="p">}</span>
     <span class="p">}</span>

     <span class="kt">void</span> <span class="nf">insert_item</span><span class="p">(</span><span class="kt">int</span> <span class="n">item</span><span class="p">)</span> <span class="p">{</span>
         <span class="n">sem_wait</span><span class="p">(</span><span class="o">&amp;</span><span class="n">empty</span><span class="p">);</span>
         <span class="n">pthread_mutex_lock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">mutex</span><span class="p">);</span>

         <span class="n">buffer</span><span class="p">[</span><span class="n">in</span><span class="p">]</span> <span class="o">=</span> <span class="n">item</span><span class="p">;</span>
         <span class="n">in</span> <span class="o">=</span> <span class="p">(</span><span class="n">in</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="n">BUFFER_SIZE</span><span class="p">;</span>
         <span class="n">printf</span><span class="p">(</span><span class="s">"Producer: inserted $%d</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">item</span><span class="p">);</span>

         <span class="n">pthread_mutex_unlock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">mutex</span><span class="p">);</span>
         <span class="n">sem_post</span><span class="p">(</span><span class="o">&amp;</span><span class="n">full</span><span class="p">);</span>
     <span class="p">}</span>

     <span class="kt">void</span> <span class="nf">remove_item</span><span class="p">(</span><span class="kt">int</span> <span class="o">*</span><span class="n">item</span><span class="p">)</span> <span class="p">{</span>
         <span class="n">sem_wait</span><span class="p">(</span><span class="o">&amp;</span><span class="n">full</span><span class="p">);</span>
         <span class="n">pthread_mutex_lock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">mutex</span><span class="p">);</span>

         <span class="o">*</span><span class="n">item</span> <span class="o">=</span> <span class="n">buffer</span><span class="p">[</span><span class="n">out</span><span class="p">];</span>
         <span class="n">out</span> <span class="o">=</span> <span class="p">(</span><span class="n">out</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="n">BUFFER_SIZE</span><span class="p">;</span>
         <span class="n">printf</span><span class="p">(</span><span class="s">"Consumer: removed $%d</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="o">*</span><span class="n">item</span><span class="p">);</span>

         <span class="n">pthread_mutex_unlock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">mutex</span><span class="p">);</span>
         <span class="n">sem_post</span><span class="p">(</span><span class="o">&amp;</span><span class="n">empty</span><span class="p">);</span>
     <span class="p">}</span>
</pre></table></code></div></div><li>Java Solution<div lang="c" class="language-c highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
</pre><td class="rouge-code"><pre>     <span class="n">public</span> <span class="n">class</span> <span class="n">BoundedBuffer</span> <span class="p">{</span>
         <span class="n">public</span> <span class="k">static</span> <span class="kt">void</span> <span class="n">main</span><span class="p">(</span><span class="n">String</span><span class="p">[]</span> <span class="n">args</span><span class="p">)</span> <span class="p">{</span>
             <span class="n">CashBox</span> <span class="n">cashBox</span> <span class="o">=</span> <span class="n">new</span> <span class="n">CashBox</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
             <span class="n">Thread</span><span class="p">[]</span> <span class="n">producers</span> <span class="o">=</span> <span class="n">new</span> <span class="n">Thread</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
             <span class="n">Thread</span><span class="p">[]</span> <span class="n">consumers</span> <span class="o">=</span> <span class="n">new</span> <span class="n">Thread</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>

             <span class="c1">// Create Threads of Producers</span>
             <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">producers</span><span class="p">.</span><span class="n">length</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                 <span class="n">producers</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">new</span> <span class="n">Thread</span><span class="p">(</span><span class="n">new</span> <span class="n">ProdRunner</span><span class="p">(</span><span class="n">cashBox</span><span class="p">));</span>
                 <span class="n">producers</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">start</span><span class="p">();</span>
             <span class="p">}</span>

             <span class="c1">// Create Threads of Consumers</span>
             <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">consumers</span><span class="p">.</span><span class="n">length</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                 <span class="n">consumers</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">new</span> <span class="n">Thread</span><span class="p">(</span><span class="n">new</span> <span class="n">ProdRunner</span><span class="p">(</span><span class="n">cashBox</span><span class="p">));</span>
                 <span class="n">consumers</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">start</span><span class="p">();</span>
             <span class="p">}</span>
         <span class="p">}</span>
     <span class="p">}</span>

     <span class="n">class</span> <span class="n">ProdRunner</span> <span class="n">implements</span> <span class="n">Runnable</span> <span class="p">{</span>
         <span class="n">CashBox</span> <span class="n">cashBox</span><span class="p">;</span>
				
         <span class="n">public</span> <span class="n">ProdRunner</span><span class="p">(</span><span class="n">CashBox</span> <span class="n">cashBox</span><span class="p">)</span> <span class="p">{</span>
             <span class="n">this</span><span class="p">.</span><span class="n">cashBox</span> <span class="o">=</span> <span class="n">cashBox</span><span class="p">;</span>
         <span class="p">}</span>

         <span class="err">@</span><span class="n">Override</span>
         <span class="n">public</span> <span class="kt">void</span> <span class="n">run</span><span class="p">()</span> <span class="p">{</span>
             <span class="n">try</span> <span class="p">{</span>
                 <span class="k">while</span> <span class="p">(</span><span class="nb">true</span><span class="p">)</span> <span class="p">{</span>
                     <span class="n">Thread</span><span class="p">.</span><span class="n">sleep</span><span class="p">((</span><span class="kt">long</span><span class="p">)</span> <span class="p">(</span><span class="n">Math</span><span class="p">.</span><span class="n">random</span><span class="p">()</span> <span class="o">*</span> <span class="mi">500</span><span class="p">));</span>
                     <span class="kt">int</span> <span class="n">money</span> <span class="o">=</span> <span class="p">((</span><span class="kt">int</span><span class="p">)</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">Math</span><span class="p">.</span><span class="n">ramdom</span><span class="p">()</span> <span class="o">*</span> <span class="mi">9</span><span class="p">))</span> <span class="o">*</span> <span class="mi">10000</span><span class="p">;</span>
                     <span class="n">cashBox</span><span class="p">.</span><span class="n">give</span><span class="p">(</span><span class="n">money</span><span class="p">);</span>
                 <span class="p">}</span>
             <span class="p">}</span> <span class="n">catch</span> <span class="p">(</span><span class="n">InterruptedException</span> <span class="n">e</span><span class="p">)</span> <span class="p">{}</span>
         <span class="p">}</span>
     <span class="p">}</span>

     <span class="n">class</span> <span class="n">ConsRunner</span> <span class="n">implements</span> <span class="n">Runnable</span> <span class="p">{</span>
         <span class="n">CashBox</span> <span class="n">cashBox</span><span class="p">;</span>

         <span class="n">public</span> <span class="n">ConsRunner</span><span class="p">(</span><span class="n">CashBox</span> <span class="n">cashBox</span><span class="p">)</span> <span class="p">{</span>
             <span class="n">this</span><span class="p">.</span><span class="n">cashBox</span> <span class="o">=</span> <span class="n">cashBox</span><span class="p">;</span>
         <span class="p">}</span>

         <span class="err">@</span><span class="n">Override</span>
         <span class="n">public</span> <span class="kt">void</span> <span class="n">run</span><span class="p">()</span> <span class="p">{</span>
             <span class="n">try</span> <span class="p">{</span>
                 <span class="k">while</span> <span class="p">(</span><span class="nb">true</span><span class="p">)</span> <span class="p">{</span>
                     <span class="n">Thread</span><span class="p">.</span><span class="n">sleep</span><span class="p">((</span><span class="kt">long</span><span class="p">)</span> <span class="p">(</span><span class="n">Math</span><span class="p">.</span><span class="n">random</span><span class="p">()</span> <span class="o">*</span> <span class="mi">500</span><span class="p">));</span>
                     <span class="kt">int</span> <span class="n">money</span> <span class="o">=</span> <span class="n">cashBox</span><span class="p">.</span><span class="n">take</span><span class="p">();</span>
                 <span class="p">}</span>
             <span class="p">}</span> <span class="n">catch</span> <span class="p">(</span><span class="n">InterruptedException</span> <span class="n">e</span><span class="p">)</span> <span class="p">{}</span>
         <span class="p">}</span>
     <span class="p">}</span>

     <span class="n">class</span> <span class="n">CashBox</span> <span class="p">{</span>

         <span class="n">private</span> <span class="kt">int</span><span class="p">[]</span> <span class="n">buffer</span><span class="p">;</span>

         <span class="n">private</span> <span class="kt">int</span> <span class="n">count</span><span class="p">,</span> <span class="n">in</span><span class="p">,</span> <span class="n">out</span><span class="p">;</span>

         <span class="n">public</span> <span class="n">CashBox</span><span class="p">(</span><span class="kt">int</span> <span class="n">bufferSize</span><span class="p">)</span> <span class="p">{</span>
             <span class="n">buffer</span> <span class="o">=</span> <span class="n">new</span> <span class="kt">int</span><span class="p">[</span><span class="n">bufferSize</span><span class="p">];</span>
             <span class="n">count</span> <span class="o">=</span> <span class="n">in</span> <span class="o">=</span> <span class="n">out</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
         <span class="p">}</span>

         <span class="n">synchronized</span> <span class="n">public</span> <span class="kt">void</span> <span class="n">give</span><span class="p">(</span><span class="kt">int</span> <span class="n">money</span><span class="p">)</span> <span class="n">throws</span> <span class="n">InterruptedException</span> <span class="p">{</span>
             <span class="k">while</span> <span class="p">(</span><span class="n">count</span> <span class="o">==</span> <span class="n">buffer</span><span class="p">.</span><span class="n">length</span><span class="p">)</span> <span class="p">{</span>
                 <span class="n">try</span> <span class="p">{</span>
                     <span class="n">wait</span><span class="p">();</span>
                 <span class="p">}</span> <span class="n">catch</span> <span class="p">(</span><span class="n">InterruptedException</span> <span class="n">e</span><span class="p">)</span> <span class="p">{}</span>
             <span class="p">}</span>

             <span class="c1">// critical section</span>
             <span class="n">buffer</span><span class="p">[</span><span class="n">in</span><span class="p">]</span> <span class="o">=</span> <span class="n">money</span><span class="p">;</span>
             <span class="n">in</span> <span class="o">=</span> <span class="p">(</span><span class="n">in</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="n">buffer</span><span class="p">.</span><span class="n">length</span><span class="p">;</span>
             <span class="n">count</span><span class="o">++</span><span class="p">;</span>
             <span class="n">System</span><span class="p">.</span><span class="n">out</span><span class="p">.</span><span class="n">printf</span><span class="p">(</span><span class="s">"여기있어: %d원</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">money</span><span class="p">);</span>

             <span class="n">notify</span><span class="p">();</span>
         <span class="p">}</span>

         <span class="n">synchronized</span> <span class="n">public</span> <span class="kt">int</span> <span class="n">take</span><span class="p">()</span> <span class="n">throws</span> <span class="n">InterruptedException</span> <span class="p">{</span>
             <span class="k">while</span> <span class="p">(</span><span class="n">count</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
                 <span class="n">try</span> <span class="p">{</span>
                     <span class="n">wait</span><span class="p">();</span>
                 <span class="p">}</span> <span class="n">catch</span> <span class="p">(</span><span class="n">InterruptedException</span> <span class="n">e</span><span class="p">)</span> <span class="p">{}</span>
             <span class="p">}</span>

             <span class="c1">// critical section</span>
             <span class="kt">int</span> <span class="n">money</span> <span class="o">=</span> <span class="n">buffer</span><span class="p">[</span><span class="n">out</span><span class="p">];</span>
             <span class="n">out</span> <span class="o">=</span> <span class="p">(</span><span class="n">out</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="n">buffer</span><span class="p">.</span><span class="n">length</span><span class="p">;</span>
             <span class="n">count</span><span class="o">--</span><span class="p">;</span>
             <span class="n">System</span><span class="p">.</span><span class="n">out</span><span class="p">.</span><span class="n">printf</span><span class="p">(</span><span class="s">"고마워요: %d원</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">money</span><span class="p">);</span>

             <span class="n">notify</span><span class="p">();</span>
             <span class="k">return</span> <span class="n">money</span><span class="p">;</span>
         <span class="p">}</span>
     <span class="p">}</span>
</pre></table></code></div></div></ol></ol><h2 id="readers-writers-문제-the-readers-writers-problem">Readers-Writers 문제 (The Readers-Writers Problem)</h2><hr /><ol><li>생산자-소비자 문제 중 다음의 특정 조건을 만족<ul><li>프로세스 분류<ul><li>공유 데이터의 내용을 읽기만 하는 프로세스 reader<li>공유 데이터의 내용을 (읽고) 쓰는 프로세스 writer</ul><li>두 reader가 동시에 공유 데이터에 접근하면 문제가 발생하지 않음<li>한 writer가 공유 데이터에 접근할 때 다른 reader나 writer가 공유 데이터에 접근하면 혼란 야기<li>이 문제가 발생하지 않도록 보장하기 위해 writer가 쓰기 작업을 하는 동안 공유 데이터에 대해 배타적 접근 권한을 가지게 할 필요성</ul><li>Readers-Writers 문제의 변형<ol><li>첫 번째 Readers-Writers 문제<ul><li>단순히 Writer가 기다리고 있다는 이유만으로 다른 Reader들이 끝날 때까지 기다리는 Reader가 있어서는 안됨<li>Reader과 Writer에게 공평한 기회 제공</ul><li>두 번째 Readers-Writers 문제<ul><li>Writer가 객체에 접근하려고 기다리고 있다면 새로운 Reader들은 읽기를 시작하지 못함<li>Reader보다 Wrtier에게 우선한 기회 제공</ul></ol></ol><h2 id="첫-번째-readers-writers-문제">첫 번째 Readers-Writers 문제</h2><hr /><ol><li>Readers-Writers 문제의 변형<ul><li>단순히 Writer가 기다리고 있다는 이유만으로 다른 Reader들이 끝날 때까지 기다리는 Reader가 있어서는 안됨<li>Reader과 Writer에게 공평한 기회 제공<li>아래 예시에서는 1개의 Writer와 n개의 Reader가 있다고 가정</ul><li>다음과 같은 자료구조를 가짐<div lang="c" class="language-c highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>     <span class="n">semaphore</span> <span class="n">rw_mutex</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
     <span class="n">semaphore</span> <span class="n">mutex</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
     <span class="kt">int</span> <span class="n">read_count</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</pre></table></code></div></div><ul><li>rw_mutex 세마포는 Reader와 Writer가 모두 공유 (1로 초기화), 주로 Writer를 위함<li>mutex 세마포는 read_count를 갱신할 때 상호 배제를 보장하기 위해 사용 (1로 초기화)<li>read_count는 현재 객체를 읽고 있는 Reader 프로세스들의 갯수</ul><li>Writer 프로세스<div lang="c" class="language-c highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre>     <span class="k">while</span> <span class="p">(</span><span class="nb">true</span><span class="p">)</span> <span class="p">{</span>
         <span class="n">wait</span><span class="p">(</span><span class="n">rw_mutex</span><span class="p">);</span>
         <span class="cm">/* ... */</span>
         <span class="cm">/* writing is performed */</span>
         <span class="cm">/* ... */</span>
         <span class="n">signal</span><span class="p">(</span><span class="n">rw_mutex</span><span class="p">);</span>
     <span class="p">}</span>
</pre></table></code></div></div><li>Reader 프로세스<div lang="c" class="language-c highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre><td class="rouge-code"><pre>     <span class="k">while</span> <span class="p">(</span><span class="nb">true</span><span class="p">)</span> <span class="p">{</span>
         <span class="n">wait</span><span class="p">(</span><span class="n">mutex</span><span class="p">);</span>
         <span class="n">read_count</span><span class="o">++</span><span class="p">;</span>
         <span class="k">if</span> <span class="p">(</span><span class="n">read_count</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
             <span class="n">wait</span><span class="p">(</span><span class="n">rw_mutex</span><span class="p">);</span>
         <span class="n">signal</span><span class="p">(</span><span class="n">mutex</span><span class="p">);</span>
         <span class="cm">/* ... */</span>
         <span class="cm">/* reading is performed */</span>
         <span class="cm">/* ... */</span>
         <span class="n">wait</span><span class="p">(</span><span class="n">mutex</span><span class="p">);</span>
         <span class="n">read_count</span><span class="o">--</span><span class="p">;</span>
         <span class="k">if</span> <span class="p">(</span><span class="n">read_count</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
             <span class="n">signal</span><span class="p">(</span><span class="n">rw_mutex</span><span class="p">);</span>
         <span class="n">signal</span><span class="p">(</span><span class="n">mutex</span><span class="p">);</span>
     <span class="p">}</span>
</pre></table></code></div></div><li>예제 소스<ol><li>Java Solution<div lang="java" class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
</pre><td class="rouge-code"><pre>     <span class="kd">class</span> <span class="nc">SharedDB</span> <span class="o">{</span>
         <span class="kd">private</span> <span class="kt">int</span> <span class="n">readerCount</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="c1">// 읽고 있는 Reader 프로세스 갯수</span>
         <span class="kd">private</span> <span class="n">boolen</span> <span class="n">isWriting</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>

         <span class="kd">public</span> <span class="kt">void</span> <span class="nf">read</span><span class="o">()</span> <span class="o">{</span>
             <span class="n">sharedDB</span><span class="o">.</span><span class="na">acquireReadLock</span><span class="o">();</span>
             <span class="n">sharedDB</span><span class="o">.</span><span class="na">read</span><span class="o">();</span>
             <span class="n">sharedDB</span><span class="o">.</span><span class="na">releaseReadLock</span><span class="o">();</span>
         <span class="o">}</span>

         <span class="kd">public</span> <span class="kt">void</span> <span class="nf">write</span><span class="o">()</span> <span class="o">{</span>
             <span class="n">sharedDB</span><span class="o">.</span><span class="na">acquireWriteLock</span><span class="o">();</span>
             <span class="n">sharedDB</span><span class="o">.</span><span class="na">write</span><span class="o">();</span>
             <span class="n">sharedDB</span><span class="o">.</span><span class="na">releaseWriteLock</span><span class="o">();</span>
         <span class="o">}</span>
     <span class="o">}</span>

     <span class="kd">synchronized</span> <span class="kd">public</span> <span class="kt">void</span> <span class="nf">acquireReadLock</span><span class="o">()</span> <span class="o">{</span>
         <span class="k">while</span> <span class="o">(</span><span class="n">isWriting</span> <span class="o">==</span> <span class="kc">true</span><span class="o">)</span> <span class="o">{</span>
             <span class="k">try</span> <span class="o">{</span>
                 <span class="n">wait</span><span class="o">();</span>
             <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{}</span>
         <span class="o">}</span>
         <span class="n">readerCount</span><span class="o">++;</span>
     <span class="o">}</span>

     <span class="kd">synchronized</span> <span class="kd">public</span> <span class="kt">void</span> <span class="nf">releaseReadLock</span><span class="o">()</span> <span class="o">{</span>
         <span class="n">readerCount</span><span class="o">--;</span>
         <span class="k">if</span> <span class="o">(</span><span class="n">readerCount</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span>
             <span class="n">notify</span><span class="o">();</span>
     <span class="o">}</span>

     <span class="kd">synchronized</span> <span class="kd">public</span> <span class="kt">void</span> <span class="nf">acquireWriteLock</span><span class="o">()</span> <span class="o">{</span>
         <span class="k">while</span> <span class="o">(</span><span class="n">readerCount</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">||</span> <span class="n">isWriting</span> <span class="o">==</span> <span class="kc">true</span><span class="o">)</span> <span class="o">{</span>
             <span class="k">try</span> <span class="o">{</span>
                 <span class="n">wait</span><span class="o">();</span>
             <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">InterrputedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{}</span>
         <span class="o">}</span>
         <span class="n">isWriting</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
     <span class="o">}</span>

     <span class="kd">synchronized</span> <span class="kd">public</span> <span class="kt">void</span> <span class="nf">releaseWriteLock</span><span class="o">()</span> <span class="o">{</span>
         <span class="n">isWriting</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
         <span class="n">notifyAll</span><span class="o">();</span>	<span class="c1">// 공평하게 Ready Queue에서 경쟁하도록 하기 위함</span>
     <span class="o">}</span>
</pre></table></code></div></div></ol></ol><h2 id="식사하는-철학자들-문제-the-dining-philosophers-problem">식사하는 철학자들 문제 (The Dining Philosophers Problem)</h2><hr /><ol><li>고전적인 동기화 문제<ul><li>많은 부류의 벙행제어 문제의 한 예<li>교착 상태와 기아를 발생시키지 않고 여러 스레드에게 여러 자원을 할당해야 할 필요를 단순하게 표현한 문제</ul><li>문제 내용 <img data-proofer-ignore data-src="/assets/img/illustrations/2022-12-25-os-synchronization-examples-00.png" alt="2022-12-25-os-synchronization-examples-00" /><ul><li>생각하고 먹으면서 시간을 보내는 5명의 철학자<li>철학자들은 원형의 테이블을 공유<li>테이블 중앙에는 한 사발의 밥<li>테이블에는 다섯 개의 젓가락<li>밥을 먹기 위해서는 두 개의 젓가락 필요<li>철학자는 생각할 때 상호 작용 없음</ul><li>해결안<ol><li>세마포 해결안 (Semaphore Solution)<ul><li>각 젓가락을 하나의 세마포로 표현<div lang="c" class="language-c highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre>  <span class="k">while</span> <span class="p">(</span><span class="nb">true</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">wait</span><span class="p">(</span><span class="n">chopstick</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
      <span class="n">wait</span><span class="p">(</span><span class="n">chopstick</span><span class="p">[(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="mi">5</span><span class="p">]);</span>
      <span class="cm">/* ... */</span>
      <span class="cm">/* eat for a while */</span>
      <span class="cm">/* ... */</span>
      <span class="n">signal</span><span class="p">(</span><span class="n">chopstick</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
      <span class="n">signal</span><span class="p">(</span><span class="n">chopstick</span><span class="p">[(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="mi">5</span><span class="p">]);</span>
      <span class="cm">/* ... */</span>
      <span class="cm">/* think for a while */</span>
      <span class="cm">/* ... */</span>
  <span class="p">}</span>
</pre></table></code></div></div><li>교착 상태를 야기할 가능성이 있기 때문에 채택하지 않음 (예) 5명의 철학자 모두가 동시에 배가 고파서 자신의 왼쪽 젓가락을 잡는 경우<li>교착 상태 문제에 대한 여러 가지 해결책<ul><li>최대 4명의 철학자만이 테이블에 동시에 앉을 수 있도록 함<li>한 철학자가 젓가락 두 개를 모두 집을 수 있을 때만 젓가락을 집도록 허용<li>비대칭 해결안 (홀수 번호의 철학자는 먼저 왼쪽 젓가락을 집고, 짝수 번호의 철학자는 먼저 오른쪽 젓가락을 집음)</ul></ul><li>모니터 해결안 (Monitor Solution)<ul><li>한 철학자가 젓가락 두 개를 모두 집을 수 있을 때만 젓가락을 집도록 허용한다는 제한을 강제<li>철학자가 처할 수 있는 세 가지 상태를 구분하기 위한 자료구조 도입<div lang="c" class="language-c highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>  <span class="k">enum</span> <span class="p">{</span><span class="n">THINKING</span><span class="p">,</span> <span class="n">HUNGRY</span><span class="p">,</span> <span class="n">EATING</span><span class="p">}</span> <span class="n">state</span><span class="p">[</span><span class="mi">5</span><span class="p">];</span>
</pre></table></code></div></div><li>철학자 i가 배가 고프더라도 젓가락 두 개를 집을 수 없을 때에는 젓가락 집는 것을 미룰 수 있도록 함<div lang="c" class="language-c highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>  <span class="n">condition</span> <span class="n">self</span><span class="p">[</span><span class="mi">5</span><span class="p">];</span>
</pre></table></code></div></div></ul><li>Pthread를 이용한 모니터 해결안 (Pthread solution to the Dining-Philosophers Problem)<div lang="c" class="language-c highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
</pre><td class="rouge-code"><pre> <span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span> <span class="cp">#include</span> <span class="cpf">&lt;stdlib.h&gt;</span><span class="cp">
</span> <span class="cp">#include</span> <span class="cpf">&lt;unistd.h&gt;</span><span class="cp">
</span> <span class="cp">#include</span> <span class="cpf">&lt;pthread.h&gt;</span><span class="cp">
</span>
 <span class="cp">#define true 1
</span> <span class="cp">#define NUM_PHILS 5
</span>
 <span class="k">enum</span> <span class="p">{</span><span class="n">THINKING</span><span class="p">,</span> <span class="n">HUNGRY</span><span class="p">,</span> <span class="n">EATING</span><span class="p">}</span> <span class="n">state</span><span class="p">[</span><span class="n">NUM_PHILS</span><span class="p">];</span>

 <span class="n">pthread_mutex_t</span> <span class="n">mutex_lock</span><span class="p">;</span>
 <span class="n">pthread_cond_t</span> <span class="n">cond_vars</span><span class="p">[</span><span class="n">NUM_PHILS</span><span class="p">];</span>

 <span class="kt">void</span> <span class="nf">init</span><span class="p">()</span> <span class="p">{</span>
     <span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
     <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">NUM_PHILS</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
         <span class="n">state</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">THINKING</span><span class="p">;</span>
         <span class="n">pthread_cond_init</span><span class="p">(</span><span class="o">&amp;</span><span class="n">cond_vars</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="nb">NULL</span><span class="p">);</span>
     <span class="p">}</span>
     <span class="n">pthread_mutex_init</span><span class="p">(</span><span class="o">&amp;</span><span class="n">mutex_lock</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
     <span class="n">srand</span><span class="p">(</span><span class="n">time</span><span class="p">(</span><span class="mi">0</span><span class="p">));</span>
 <span class="p">}</span>

 <span class="kt">int</span> <span class="nf">leftOf</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="p">)</span> <span class="p">{</span>
     <span class="k">return</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="n">NUM_PHILS</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="n">NUM_PHILS</span><span class="p">;</span>
 <span class="p">}</span>

 <span class="kt">int</span> <span class="nf">rightOf</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="p">)</span> <span class="p">{</span>
     <span class="k">return</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="n">NUM_PHILS</span><span class="p">;</span>
 <span class="p">}</span>

 <span class="kt">void</span> <span class="nf">think</span><span class="p">(</span><span class="kt">int</span> <span class="n">id</span><span class="p">)</span> <span class="p">{</span>
     <span class="n">printf</span><span class="p">(</span><span class="s">"%d: Now, I'm thinking...</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">id</span><span class="p">);</span>
     <span class="n">usleep</span><span class="p">((</span><span class="mi">1</span> <span class="o">+</span> <span class="n">rand</span><span class="p">()</span> <span class="o">%</span> <span class="mi">50</span><span class="p">)</span> <span class="o">*</span> <span class="mi">10000</span><span class="p">);</span>
 <span class="p">}</span>

 <span class="kt">void</span> <span class="nf">eat</span><span class="p">(</span><span class="kt">int</span> <span class="n">id</span><span class="p">)</span> <span class="p">{</span>
     <span class="n">printf</span><span class="p">(</span><span class="s">"%d: Now, I'm eating...</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">id</span><span class="p">);</span>
     <span class="n">usleep</span><span class="p">((</span><span class="mi">1</span> <span class="o">+</span> <span class="n">rand</span><span class="p">()</span> <span class="o">%</span> <span class="mi">50</span><span class="p">)</span> <span class="o">*</span> <span class="mi">10000</span><span class="p">);</span>
 <span class="p">}</span>

 <span class="kt">void</span> <span class="nf">test</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="p">)</span> <span class="p">{</span>
     <span class="c1">// If I'm hungry and my neighbors are not eating,</span>
     <span class="c1">// then let me eat.</span>
     <span class="k">if</span> <span class="p">(</span><span class="n">state</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="n">HUNGRY</span> <span class="o">&amp;&amp;</span>
         <span class="n">state</span><span class="p">[</span><span class="n">leftOf</span><span class="p">(</span><span class="n">i</span><span class="p">)]</span> <span class="o">!=</span> <span class="n">EATING</span> <span class="o">&amp;&amp;</span> <span class="n">state</span><span class="p">[</span><span class="n">rightOf</span><span class="p">(</span><span class="n">i</span><span class="p">)]</span> <span class="o">!=</span> <span class="n">EATING</span><span class="p">)</span> <span class="p">{</span>
             <span class="n">state</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">EATING</span><span class="p">;</span>
             <span class="n">pthread_cond_signal</span><span class="p">(</span><span class="o">&amp;</span><span class="n">cond_vars</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
     <span class="p">}</span>
 <span class="p">}</span>

 <span class="kt">void</span> <span class="nf">pickup</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="p">)</span> <span class="p">{</span>
     <span class="n">pthread_mutex_lock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">mutex_lock</span><span class="p">);</span>

     <span class="n">state</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">HUNGRY</span><span class="p">;</span>
     <span class="n">test</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
     <span class="k">while</span> <span class="p">(</span><span class="n">state</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="n">EATING</span><span class="p">)</span> <span class="p">{</span>
         <span class="n">pthread_cond_wait</span><span class="p">(</span><span class="o">&amp;</span><span class="n">cond_vars</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="o">&amp;</span><span class="n">mutex_lock</span><span class="p">);</span>
     <span class="p">}</span>

     <span class="n">pthread_mutex_unlock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">mutex_lock</span><span class="p">);</span>
 <span class="p">}</span>

 <span class="kt">void</span> <span class="nf">putdown</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="p">)</span> <span class="p">{</span>
     <span class="n">pthread_mutex_lock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">mutex_lock</span><span class="p">);</span>

     <span class="n">state</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">THINKING</span><span class="p">;</span>
     <span class="n">test</span><span class="p">(</span><span class="n">leftOf</span><span class="p">(</span><span class="n">i</span><span class="p">));</span>
     <span class="n">test</span><span class="p">(</span><span class="n">rightOf</span><span class="p">(</span><span class="n">i</span><span class="p">));</span>

     <span class="n">pthread_mutex_unlock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">mutex_lock</span><span class="p">);</span>
 <span class="p">}</span>

 <span class="kt">void</span> <span class="o">*</span><span class="nf">philosopher</span><span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="n">param</span><span class="p">)</span> <span class="p">{</span>
     <span class="kt">int</span> <span class="n">id</span> <span class="o">=</span> <span class="o">*</span><span class="p">((</span><span class="kt">int</span> <span class="o">*</span><span class="p">)</span><span class="n">param</span><span class="p">);</span>
     <span class="k">while</span> <span class="p">(</span><span class="nb">true</span><span class="p">)</span> <span class="p">{</span>
         <span class="n">think</span><span class="p">(</span><span class="n">id</span><span class="p">);</span>
         <span class="n">pickup</span><span class="p">(</span><span class="n">id</span><span class="p">);</span>
         <span class="n">eat</span><span class="p">(</span><span class="n">id</span><span class="p">);</span>
         <span class="n">putdown</span><span class="p">(</span><span class="n">id</span><span class="p">);</span>
     <span class="p">}</span>
 <span class="p">}</span>

 <span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
     <span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
     <span class="n">pthread_t</span> <span class="n">tid</span><span class="p">;</span>
     <span class="n">init</span><span class="p">();</span>
     <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">NUM_PHILS</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
         <span class="n">pthread_create</span><span class="p">(</span><span class="o">&amp;</span><span class="n">tid</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="n">philosopher</span><span class="p">,</span> <span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">i</span><span class="p">);</span>
     <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">NUM_PHILS</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
         <span class="n">pthread_join</span><span class="p">(</span><span class="n">tid</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
     <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
 <span class="p">}</span>
</pre></table></code></div></div><li>Java를 이용한 모니터 해결안 (Java solution to the Dining-Philosophers Problem)<div lang="java" class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
</pre><td class="rouge-code"><pre> <span class="kn">package</span> <span class="nn">os.concepts</span><span class="o">;</span>

 <span class="kn">import</span> <span class="nn">java.util.concurrent.locks.Condition</span><span class="o">;</span>
 <span class="kn">import</span> <span class="nn">java.util.concurrent.locks.Lock</span><span class="o">;</span>
 <span class="kn">import</span> <span class="nn">java.util.concurrent.locks.ReentrantLock</span><span class="o">;</span>

 <span class="kd">enum</span> <span class="nc">State</span> <span class="o">{</span>
     <span class="no">THINKING</span><span class="o">,</span> <span class="no">HUNGRY</span><span class="o">,</span> <span class="no">EATING</span>
 <span class="o">}</span>

 <span class="kd">public</span> <span class="kd">class</span> <span class="nc">DiningPhilosophers</span> <span class="o">{</span>

     <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
         <span class="kt">int</span> <span class="n">numOfPhils</span> <span class="o">=</span> <span class="mi">5</span><span class="o">;</span>
         <span class="nc">Philosopher</span><span class="o">[]</span> <span class="n">philosophers</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Philosopher</span><span class="o">[</span><span class="n">numOfPhils</span><span class="o">];</span>
         <span class="nc">DiningPhilosopherMonitor</span> <span class="n">monitor</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">DiningPhilosopherMonitor</span><span class="o">(</span><span class="n">numOfPhils</span><span class="o">);</span>
         <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">philosophers</span><span class="o">.</span><span class="na">length</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span>
             <span class="k">new</span> <span class="nf">Thread</span><span class="o">(</span><span class="k">new</span> <span class="nc">Philosopher</span><span class="o">(</span><span class="n">i</span><span class="o">,</span> <span class="n">monitor</span><span class="o">)).</span><span class="na">start</span><span class="o">();</span>
     <span class="o">}</span>
 <span class="o">}</span>

 <span class="kd">class</span> <span class="nc">Philosopher</span> <span class="kd">implements</span> <span class="nc">Runnable</span> <span class="o">{</span>

     <span class="kd">private</span> <span class="kt">int</span> <span class="n">id</span><span class="o">;</span>
     <span class="kd">private</span> <span class="nc">DiningPhilosopherMonitor</span> <span class="n">monitor</span><span class="o">;</span>

     <span class="kd">public</span> <span class="nf">Philosopher</span><span class="o">(</span><span class="kt">int</span> <span class="n">id</span><span class="o">,</span> <span class="nc">DiningPhilosopherMonitor</span> <span class="n">monitor</span><span class="o">)</span> <span class="o">{</span>
         <span class="k">this</span><span class="o">.</span><span class="na">id</span> <span class="o">=</span> <span class="n">id</span><span class="o">;</span>
         <span class="k">this</span><span class="o">.</span><span class="na">monitor</span> <span class="o">=</span> <span class="n">monitor</span><span class="o">;</span>
     <span class="o">}</span>

     <span class="nd">@Override</span>
     <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
         <span class="k">while</span> <span class="o">(</span><span class="kc">true</span><span class="o">)</span> <span class="o">{</span>
             <span class="n">think</span><span class="o">();</span>
             <span class="n">monitor</span><span class="o">.</span><span class="na">pickup</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
             <span class="n">eat</span><span class="o">();</span>
             <span class="n">monitor</span><span class="o">.</span><span class="na">putdown</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
         <span class="o">}</span>
     <span class="o">}</span>

     <span class="kd">private</span> <span class="kt">void</span> <span class="nf">think</span><span class="o">()</span> <span class="o">{</span>
         <span class="k">try</span> <span class="o">{</span>
             <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">id</span> <span class="o">+</span> <span class="s">": Now I'm thinking."</span><span class="o">);</span>
             <span class="nc">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">((</span><span class="kt">long</span><span class="o">)(</span><span class="nc">Math</span><span class="o">.</span><span class="na">random</span><span class="o">()*</span><span class="mi">500</span><span class="o">));</span>
         <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span> <span class="o">}</span>
     <span class="o">}</span>

     <span class="kd">private</span> <span class="kt">void</span> <span class="nf">eat</span><span class="o">()</span> <span class="o">{</span>
         <span class="k">try</span> <span class="o">{</span>
             <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">id</span> <span class="o">+</span> <span class="s">": Now I'm eating."</span><span class="o">);</span>
             <span class="nc">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">((</span><span class="kt">long</span><span class="o">)(</span><span class="nc">Math</span><span class="o">.</span><span class="na">random</span><span class="o">()*</span><span class="mi">50</span><span class="o">));</span>
         <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span> <span class="o">}</span>
     <span class="o">}</span>
 <span class="o">}</span>

 <span class="kd">class</span> <span class="nc">DiningPhilosopherMonitor</span> <span class="o">{</span>

     <span class="kd">private</span> <span class="kt">int</span> <span class="n">numOfPhils</span><span class="o">;</span>
     <span class="kd">private</span> <span class="nc">State</span><span class="o">[]</span> <span class="n">state</span><span class="o">;</span>
     <span class="kd">private</span> <span class="nc">Condition</span><span class="o">[]</span> <span class="n">self</span><span class="o">;</span>
     <span class="kd">private</span> <span class="nc">Lock</span> <span class="n">lock</span><span class="o">;</span>

     <span class="kd">public</span> <span class="nf">DiningPhilosopherMonitor</span><span class="o">(</span><span class="kt">int</span> <span class="n">num</span><span class="o">)</span> <span class="o">{</span>
         <span class="n">numOfPhils</span> <span class="o">=</span> <span class="n">num</span><span class="o">;</span>
         <span class="n">state</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">State</span><span class="o">[</span><span class="n">num</span><span class="o">];</span>
         <span class="n">self</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Condition</span><span class="o">[</span><span class="n">num</span><span class="o">];</span>
         <span class="n">lock</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ReentrantLock</span><span class="o">();</span>
         <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">num</span> <span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
             <span class="n">state</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">=</span> <span class="nc">State</span><span class="o">.</span><span class="na">THINKING</span><span class="o">;</span>
             <span class="n">self</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">=</span> <span class="n">lock</span><span class="o">.</span><span class="na">newCondition</span><span class="o">();</span>
         <span class="o">}</span>
     <span class="o">}</span>

     <span class="kd">private</span> <span class="kt">int</span> <span class="nf">leftOf</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">)</span> <span class="o">{</span>
         <span class="k">return</span> <span class="o">(</span><span class="n">i</span> <span class="o">+</span> <span class="n">numOfPhils</span> <span class="o">-</span> <span class="mi">1</span><span class="o">)</span> <span class="o">%</span> <span class="n">numOfPhils</span><span class="o">;</span>
     <span class="o">}</span>

     <span class="kd">private</span> <span class="kt">int</span> <span class="nf">rightOf</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">)</span> <span class="o">{</span>
         <span class="k">return</span> <span class="o">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="o">)</span> <span class="o">%</span> <span class="n">numOfPhils</span><span class="o">;</span>
     <span class="o">}</span>

     <span class="kd">private</span> <span class="kt">void</span> <span class="nf">test</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">)</span> <span class="o">{</span>
         <span class="k">if</span> <span class="o">(</span><span class="n">state</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">==</span> <span class="nc">State</span><span class="o">.</span><span class="na">HUNGRY</span> <span class="o">&amp;&amp;</span>
                 <span class="n">state</span><span class="o">[</span><span class="n">leftOf</span><span class="o">(</span><span class="n">i</span><span class="o">)]</span> <span class="o">!=</span> <span class="nc">State</span><span class="o">.</span><span class="na">EATING</span> <span class="o">&amp;&amp;</span>
                 <span class="n">state</span><span class="o">[</span><span class="n">rightOf</span><span class="o">(</span><span class="n">i</span><span class="o">)]</span> <span class="o">!=</span> <span class="nc">State</span><span class="o">.</span><span class="na">EATING</span><span class="o">)</span> <span class="o">{</span>
             <span class="n">state</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">=</span> <span class="nc">State</span><span class="o">.</span><span class="na">EATING</span><span class="o">;</span>
             <span class="n">self</span><span class="o">[</span><span class="n">i</span><span class="o">].</span><span class="na">signal</span><span class="o">();</span>
         <span class="o">}</span>
     <span class="o">}</span>

     <span class="kd">public</span> <span class="kt">void</span> <span class="nf">pickup</span><span class="o">(</span><span class="kt">int</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
         <span class="n">lock</span><span class="o">.</span><span class="na">lock</span><span class="o">();</span>
         <span class="k">try</span> <span class="o">{</span>
             <span class="n">state</span><span class="o">[</span><span class="n">id</span><span class="o">]</span> <span class="o">=</span> <span class="nc">State</span><span class="o">.</span><span class="na">HUNGRY</span><span class="o">;</span>
             <span class="n">test</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
             <span class="k">if</span> <span class="o">(</span><span class="n">state</span><span class="o">[</span><span class="n">id</span><span class="o">]</span> <span class="o">!=</span> <span class="nc">State</span><span class="o">.</span><span class="na">EATING</span><span class="o">)</span>
                 <span class="n">self</span><span class="o">[</span><span class="n">id</span><span class="o">].</span><span class="na">await</span><span class="o">();</span>
         <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
         <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
             <span class="n">lock</span><span class="o">.</span><span class="na">unlock</span><span class="o">();</span>
         <span class="o">}</span>
     <span class="o">}</span>

     <span class="kd">public</span> <span class="kt">void</span> <span class="nf">putdown</span><span class="o">(</span><span class="kt">int</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
         <span class="n">lock</span><span class="o">.</span><span class="na">lock</span><span class="o">();</span>
         <span class="k">try</span> <span class="o">{</span>
             <span class="n">state</span><span class="o">[</span><span class="n">id</span><span class="o">]</span> <span class="o">=</span> <span class="nc">State</span><span class="o">.</span><span class="na">THINKING</span><span class="o">;</span>
             <span class="n">test</span><span class="o">(</span><span class="n">leftOf</span><span class="o">(</span><span class="n">id</span><span class="o">));</span>   <span class="c1">// left neighbor</span>
             <span class="n">test</span><span class="o">(</span><span class="n">rightOf</span><span class="o">(</span><span class="n">id</span><span class="o">));</span>  <span class="c1">// right neighbor</span>
         <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
             <span class="n">lock</span><span class="o">.</span><span class="na">unlock</span><span class="o">();</span>
         <span class="o">}</span>
     <span class="o">}</span>
 <span class="o">}</span>
</pre></table></code></div></div></ol></ol><h2 id="대체-방안들">대체 방안들</h2><div lang="plaintext" class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>1. 트랜잭션 메모리 Transactional Memory
2. OpenMP
3. Functional Programming Language
</pre></table></code></div></div><h2 id="참고">참고</h2><hr /><ol><li>운영체제 공룡책 강의 | 주니온 | 인프런 https://www.inflearn.com/course/%EC%9A%B4%EC%98%81%EC%B2%B4%EC%A0%9C-%EA%B3%B5%EB%A3%A1%EC%B1%85-%EC%A0%84%EA%B3%B5%EA%B0%95%EC%9D%98/dashboard<li><div class="table-wrapper"><table><tbody><tr><td>운영체제 제 10판<td>Abraham Silberschatz, Peter Baer Galvin, Greg Gagne 저/박민규 역<td>퍼스트북<td>2020년 02월 28일</table></div><li>운영체제 제 10판 솔루션 https://codex.cs.yale.edu/avi/os-book/OS10/practice-exercises/index-solu.html</ol></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/cs/'>CS</a>, <a href='/categories/os/'>OS</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/cs/" class="post-tag no-text-decoration" >CS</a> <a href="/tags/os/" class="post-tag no-text-decoration" >OS</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/?v=1743601323"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=OS Synchronization Examples - Develiberta&url=https://develiberta.github.io/posts/os-synchronization-examples/?v=1743601323" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=OS Synchronization Examples - Develiberta&u=https://develiberta.github.io/posts/os-synchronization-examples/?v=1743601323" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=OS Synchronization Examples - Develiberta&url=https://develiberta.github.io/posts/os-synchronization-examples/?v=1743601323" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink('', 'Link copied successfully!')" data-toggle="tooltip" data-placement="top" title="Copy link"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/os-definition/?v=1743601323">OS Definition</a><li><a href="/posts/os-storage-management/?v=1743601323">Storage Management</a><li><a href="/posts/os-virtual-memory/?v=1743601323">Virtual Memroy</a><li><a href="/posts/os-main-memory/?v=1743601323">Main Memroy</a><li><a href="/posts/os-deadlocks/?v=1743601323">Deadlocks</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/cs/?v=1743601323">CS</a> <a class="post-tag" href="/tags/os/?v=1743601323">OS</a> <a class="post-tag" href="/tags/securiy/?v=1743601323">Securiy</a> <a class="post-tag" href="/tags/ansible/?v=1743601323">Ansible</a> <a class="post-tag" href="/tags/devops/?v=1743601323">DevOps</a> <a class="post-tag" href="/tags/linux/?v=1743601323">Linux</a> <a class="post-tag" href="/tags/typography/?v=1743601323">typography</a> <a class="post-tag" href="/tags/algorithm/?v=1743601323">Algorithm</a> <a class="post-tag" href="/tags/favicon/?v=1743601323">favicon</a> <a class="post-tag" href="/tags/getting-started/?v=1743601323">getting started</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/os-thread-02/?v=1743601323"><div class="card-body"> <span class="timeago small" >Oct 23, 2022<i class="unloaded">2022-10-23T13:00:00+09:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>OS Thread (2)</h3><div class="text-muted small"><p> 목적 CPU 이용의 기본 단위가 된 스레드를 이해한다. 실천 목표 스레드 풀, 포크 조인 및 그랜드 센트럴 디스패치를 포함하여 암시적 스레딩에 대한 다양한 접근 방식을 설명한다. Windows 및 Linux 운영체제가 스레드를 어떻게 나타내는지 설명한다. Pthread, Java 및 Windows 스레딩 API를 사용하여 ...</p></div></div></a></div><div class="card"> <a href="/posts/os-cpu-scheduling-01/?v=1743601323"><div class="card-body"> <span class="timeago small" >Oct 29, 2022<i class="unloaded">2022-10-29T13:00:00+09:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>OS CPU Scheduling</h3><div class="text-muted small"><p> 목적 CPU 이용의 기본 단위가 된 스레드를 이해한다. 실천 목표 다양한 CPU 스케줄링 알고리즘을 설명한다. 스케줄링 기준에 따라 CPU 스케줄링 알고리즘을 평가한다. 한정된 CPU (코어) 자원과 수많은 프로세스(및 스레드) 한정된 CPU (코어)를 효율적으로 할당하기 위한 스케줄링 필요 기본적인 개념 정리...</p></div></div></a></div><div class="card"> <a href="/posts/os-synchronization-tools/?v=1743601323"><div class="card-body"> <span class="timeago small" >Nov 12, 2022<i class="unloaded">2022-11-12T13:00:00+09:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>OS Synchronization Tools</h3><div class="text-muted small"><p> 목적 협력적 프로세스가 동시에 데이터에 접근할 때 발생하는 문제를 이해한다. 임계구역 문제에 대한 하드웨어 해결책과 소프트웨어 해결책을 이해한다. 실천 목표 임계구역 문제를 설명하고 경쟁 조건(Race Condition)을 설명한다. 메모리 장벽, compare-and-swap 연산 및 원자적 변수를 사용하여 임계구역 문제...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/os-synchronization-tools/?v=1743601323" class="btn btn-outline-primary" prompt="Older"><p>OS Synchronization Tools</p></a> <a href="/posts/os-deadlocks/?v=1743601323" class="btn btn-outline-primary" prompt="Newer"><p>Deadlocks</p></a></div><script src="https://utteranc.es/client.js" repo="develiberta/blog-comments" issue-term="url" theme="github-light" crossorigin="anonymous" async> </script> <script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2025 <a href="https://twitter.com/develiberta">develiberta</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/cs/?v=1743601323">CS</a> <a class="post-tag" href="/tags/os/?v=1743601323">OS</a> <a class="post-tag" href="/tags/securiy/?v=1743601323">Securiy</a> <a class="post-tag" href="/tags/ansible/?v=1743601323">Ansible</a> <a class="post-tag" href="/tags/devops/?v=1743601323">DevOps</a> <a class="post-tag" href="/tags/linux/?v=1743601323">Linux</a> <a class="post-tag" href="/tags/typography/?v=1743601323">typography</a> <a class="post-tag" href="/tags/algorithm/?v=1743601323">Algorithm</a> <a class="post-tag" href="/tags/favicon/?v=1743601323">favicon</a> <a class="post-tag" href="/tags/getting-started/?v=1743601323">getting started</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://develiberta.github.io{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js"></script> <script defer src="/assets/js/dist/post.min.js?v=1743601323"></script> <script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.16.1,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/app.js?v=1743601323"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id="></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', ''); }); </script>
